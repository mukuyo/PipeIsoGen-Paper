\chapter{%
深層学習による配管6D姿勢推定}

従来のアイソメ図取得にはLIDARセンサーにより３次元点群を取得し図面を作成していたが、
センサーが高価であるというデメリットを抱えていた。そのため、本研究ではLIDARセンサーよりも
比較的安価なRGB-Dカメラを用いてデータセット収集から深層学習やアイソメ図作成までの流れを紹介する。
第2.1節ではRGB-Dカメラを用いた深層学習による配管6D姿勢推定の手順を述べる。
第2.2節では物体認識のネットワーク設計を詳しく説明する。


\section{配管6D姿勢推定方法}
RGB-Dカメラを用いた深層学習による配管のアイソメ図作成の手順はデータ収集、物体検出、6D姿勢推定、アイソメ図作成の４つに分けられる。
図2.1にそのプロセスの流れを示す。

\begin{figure}[htbt]
	\centering
	 \includegraphics[height=65mm]{system.eps}
	 \caption{RGB-Dカメラを用いた深層学習によるアイソメ図作成方法}
	 \label{fig:f2}
\end{figure}

まず、RGB-Dカメラを用いてRGB画像とDepth画像を取得する。これらの画像を使用して物体検出ネットワークより複数の配管検出を行う。
次に、物体検出で認識された配管の姿勢を推定する。その際に、データセットとしてRGB画像から３次元復元ツールであるColmapを使用して
点群データを取得する。このColmapはStructure from Motion(SfM)という技術で異なる視点からの写真を使用して３次元形状を復元する
写真解析ソフトウェアである。Colmapから得られた点群データをもとに姿勢推定問題に取り組む。
最後に姿勢推定された結果を用いてアイソメ図を作成するが、図面には配管の距離情報を示す必要がある。
そのため、Depth画像を用いることで認識された配管のスケールを算出することができる。以上のステップを踏むことでRGB-Dカメラから
アイソメ図を作成することができる。

\section{配管の特徴を活かしたアイソメ図作成方法}
配管の形状には配管固有の特徴が存在する。図2.2に一部配管の例を示す。
配管は両端部分を除くと直線であるという特徴があるため、両端の曲管又はT字管がどの方向を向いているのかを認識できればその間を直線で結ぶことで
アイソメ図を作成することができる。そのため、本研究においては配管全体を認識するのではなく、画像内の曲管及びT字管を検出し姿勢を推定する。
それに加え、両端の曲管又はT字管間の距離をDepth画像を用いて算出することで図面を作成することができる。

\begin{figure}[htbt]
	\centering
	 \includegraphics[height=55mm]{pipe.eps}
	 \caption{配管の検出例}
	 \label{fig:f2}
\end{figure}

\section{ネットワーク構造}

\subsection{全体構成}
本研究では曲管及び、T字管の物体検出と6D姿勢推定を深層学習を用いて推定する。その全体構成を図2.3に示す。
物体検出ネットワークではRXD Layer用いたRXDネットワークを提案する。RGB画像とDepth画像をRXD Layerに挿入することで
それぞれの画像から抽出された特徴を結合し認識精度向上を図ることができる。また、姿勢推定ネットワークではGen6Dモデルを使用する。
Gen6Dは複数物体の検出ができないが、RXDネットワークから認識された複数の配管のピクセル座標とスケールをGen6DのSelectorに
それぞれ渡すことでRefinerを通して最終的に画像内の全ての曲管及びT字管の姿勢を求めることが可能になる。

\subsection{RXDネットワーク}
物体検出に使用するRXDネットワークについて紹介する。RXDネットワークの構成を図2.4に示す。

\begin{figure}[htbt]
	\centering
	 \includegraphics[height=95mm]{RXDnet.eps}
	 \caption{RXDネットワーク構造図}
	 \label{fig:f2}
\end{figure}